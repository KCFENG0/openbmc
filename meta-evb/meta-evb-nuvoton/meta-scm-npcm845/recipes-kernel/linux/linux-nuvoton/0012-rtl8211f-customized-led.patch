From f28696f1740cbaf53967fad5bcaf43f10e3e64db Mon Sep 17 00:00:00 2001
From: Joseph Liu <kwliu@nuvoton.com>
Date: Mon, 1 Aug 2022 17:59:00 +0800
Subject: [PATCH] rtl8211f: customized led

Signed-off-by: Joseph Liu <kwliu@nuvoton.com>
---
 drivers/net/phy/realtek.c | 53 +++++++++++++++++++++++++++++++++++++++
 1 file changed, 53 insertions(+)

diff --git a/drivers/net/phy/realtek.c b/drivers/net/phy/realtek.c
index b5b21c06ae43..852362338082 100644
--- a/drivers/net/phy/realtek.c
+++ b/drivers/net/phy/realtek.c
@@ -149,6 +149,58 @@ static int rtl8211f_config_intr(struct phy_device *phydev)
 	return phy_write_paged(phydev, 0xa42, RTL821x_INER, val);
 }
 
+static int rtl8211f_read_status(struct phy_device *phydev)
+{
+	int ret, reg;
+
+	ret = genphy_read_status(phydev);
+	if (ret < 0)
+		return ret;
+
+	rtl821x_write_page(phydev, 0xd04);
+
+	if (phydev->speed == SPEED_1000) {
+		__phy_write(phydev, 0x10, 0x6008);
+		__phy_write(phydev, 0x11, 0x6008);
+	} else if (phydev->speed == SPEED_100) {
+		__phy_write(phydev, 0x10, 0x4840);
+		__phy_write(phydev, 0x11, 0x6008);
+	} else if (phydev->speed == SPEED_10) {
+		__phy_write(phydev, 0x10, 0x4400);
+		__phy_write(phydev, 0x11, 0x600f);
+	} 
+
+	rtl821x_write_page(phydev, 0);
+	return 0;
+}
+
+
+static int rtl8211f_aneg_done(struct phy_device *phydev)
+{
+	int aneg_done = genphy_aneg_done(phydev);
+
+	printk("joseph phydev->speed 0x%x \n", phydev->speed);
+
+	rtl821x_write_page(phydev, 0xd04);
+
+	if (phydev->speed == SPEED_1000) {
+		__phy_write(phydev, 0x10, 0x6008);
+		__phy_write(phydev, 0x11, 0x6008);
+	} else if (phydev->speed == SPEED_100) {
+		__phy_write(phydev, 0x10, 0x4840);
+		__phy_write(phydev, 0x11, 0x6008);
+	} else if (phydev->speed == SPEED_10) {
+		__phy_write(phydev, 0x10, 0x4400);
+		__phy_write(phydev, 0x11, 0x600f);
+	} 
+
+	rtl821x_write_page(phydev, 0);
+
+	return aneg_done;
+}
+
+
+
 static int rtl8211_config_aneg(struct phy_device *phydev)
 {
 	int ret;
@@ -634,6 +686,7 @@ static struct phy_driver realtek_drvs[] = {
 		PHY_ID_MATCH_EXACT(0x001cc916),
 		.name		= "RTL8211F Gigabit Ethernet",
 		.config_init	= &rtl8211f_config_init,
+		.read_status	= &rtl8211f_read_status,
 		.ack_interrupt	= &rtl8211f_ack_interrupt,
 		.config_intr	= &rtl8211f_config_intr,
 		.suspend	= genphy_suspend,
-- 
2.34.1

